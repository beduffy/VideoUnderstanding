<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">

	<!--TODO change -->
	<title>Horizontally Scrolling Site from CSS-Tricks</title>

	<link rel="stylesheet" type="text/css" href="video_results.css">


    <style>
	rect {
		fill: steelblue;
	}
</style>

</head>



<body>

	<h1>Video</h1>
	<div id="page-wrap">

	</div>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="jquery.mousewheel.js"></script>
<script>
	// Global Variables
	var scrollRate = 1000;
	var imageDirectory;
	var globalData;

	var QueryString = function () {
	  // This function is anonymous, is executed immediately and
	  // the return value is assigned to QueryString!
	  var query_string = {};
	  var query = window.location.search.substring(1);
	  var vars = query.split("&");
	  for (var i=0;i<vars.length;i++) {
		var pair = vars[i].split("=");
			// If first entry with this name
		if (typeof query_string[pair[0]] === "undefined") {
		  query_string[pair[0]] = decodeURIComponent(pair[1]);
			// If second entry with this name
		} else if (typeof query_string[pair[0]] === "string") {
		  var arr = [ query_string[pair[0]],decodeURIComponent(pair[1]) ];
		  query_string[pair[0]] = arr;
			// If third or later entry with this name
		} else {
		  query_string[pair[0]].push(decodeURIComponent(pair[1]));
		}
	  }
		return query_string;
	}();

	$(function() {
		$("#page-wrap").wrapInner("<table cellspacing='30'><tr>");

		console.log(QueryString.video);
		var videoName = QueryString.video;
		imageDirectory = 'example_images/' + videoName + '/';
		var result_file_path = imageDirectory + 'result_struct.json';
//		loadDataset(result_file_path);
		loadDataset2(result_file_path);
		$("body").mousewheel(function(event, delta) {
			//TODO fix when it hits the end
			this.scrollLeft -= (delta * scrollRate);
			event.preventDefault();
		});


	});

	// Data Loading
    function loadDataset(jsonpath) {
		$.getJSON(jsonpath, function(data) {
			console.log(data);

			var $pageWrap = $("#page-wrap");

			for (var i = 0; i < data.imgblobs.length; i++) {
				//TODO wrap text description within frame width.
				var imagePath = imageDirectory + data.imgblobs[i].img_path;
				var htmlString = "<td><div class='frame' > <img class='img_frame' src='" + imagePath + "' > " +
						"<div class='description'>" + data.imgblobs[i].candidates[0].text +  "</div> "+
						"</div></td>";



				//TODO IDEAL JSON FORMAT
				/*
				var description = "";
				for (var j = 0; j < data.imgblobs[j].descriptions.length; j++) {
					description += data.imgblobs[j].descriptions[j];
				}
				var htmlString = "<td><div class='frame' > <img class='img_frame' src='" + imagePath + "' > " +
					"<div class='description'>" + data.imgblobs[i].candidates[0].text +  "</div> "+
					"</div></td>";
				*/

				//var htmlString = "<td><div class='frame' > hey </div></td>";
				$pageWrap.append(htmlString);
			}

			/*writeHeader();
			visSentencesInit();*/
      });
    }

	function loadDataset2(jsonpath) {
		$.getJSON(jsonpath, function(data) {
			console.log(data);
			globalData = data;
			var $pageWrap = $("#page-wrap");

			for (var i = 0; i < data.images.length; i++) {
				//TODO wrap text description within frame width.
				var imagePath = imageDirectory + data.images[i].name;

				var fullBarWidth = 400;
				var svgString = '<svg><g transform="translate(0,0)">';
				var widthTravelled = 0;
				//TODO CHANGE 3 TO LENGTH
				for(var j = 0; j < 3; j++) {
					var width = data.images[i].kmeans[j][0] * 400;
					var fillString = 'style="fill:rgb(' + data.images[i].kmeans[j][1][0] + ',' + data.images[i].kmeans[j][1][1] + ',' + data.images[i].kmeans[j][1][2] + ')"';

					svgString += '<rect x=' + widthTravelled + ' width="' + width + '" height="40"' + fillString + '></rect>';
					widthTravelled += width;
				}
				svgString += '</g></svg>';

				//todo fix scene desc
				var sceneResultsString = "<div class='scene_desc'>";
				for (var a = 0; a < 5; a++) {
					var label_prob = data.images[i].scene_results.scene_results1[a].label + ' : ' + data.images[i].scene_results.scene_results1[a].probability;
					sceneResultsString += "<div style='font-size: large;'>" + label_prob + "</div>";
				}
				sceneResultsString += "</div";

				var sceneResultsString2 = "<div class='scene_desc'>";
				for (var a = 0; a < 5; a++) {
					var label_prob = data.images[i].scene_results.scene_results2[a].label + ' : ' + data.images[i].scene_results.scene_results2[a].probability;
					sceneResultsString2 += "<div style='font-size: large;'>" + label_prob + "</div>";
				}
				sceneResultsString2 += "</div";

                var weightSceneResultsString = "<div class='scene_desc'>";
                for (var a = 0; a < 5; a++) {
                    var label_prob1 = {"label": data.images[i].scene_results.scene_results1[a].label, "prob" : data.images[i].scene_results.scene_results1[a].probability};
                    for (var b = 0; b < 5; b++) {
                        var label_prob2 = {"label": data.images[i].scene_results.scene_results2[b].label, "prob" : data.images[i].scene_results.scene_results2[b].probability};
                        if (label_prob2.label === label_prob1.label) {
                            var new_label_prob = label_prob1.label + ' : ' + (label_prob2.prob + label_prob1.prob);
					        weightSceneResultsString += "<div style='font-size: large;'>" + new_label_prob + "</div>";
                            break;
                        }
                    }
                }
                weightSceneResultsString += "</div";

				var htmlString = "<td><div class='frame' > <img class='img_frame' src='" + imagePath + "' > " +
						svgString + sceneResultsString + "<br><br>" + sceneResultsString2 + "<br>" + weightSceneResultsString + "<br><br>" +//+ "<div class='description'>"  + "</div> " +
						"</div></td>";

				$pageWrap.append(htmlString);
			}
		});
	}


</script>

</body>

</html>